<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Superh√©roes Estoicos: Aventura Interactiva</title>
    <!-- 1. Cargar Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Cargar la fuente Inter --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* 3. Definir la fuente para todo el cuerpo */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff; /* bg-blue-50 */
            color: #1f2937; /* text-gray-800 */
        }
        
        /* 4. Estilos para el juego de Arrastrar y Soltar (Drag and Drop) */
        
        /* Estilo para el objeto que est√°s arrastrando */
        .dragging {
            opacity: 0.5;
            transform: scale(1.05);
            background-color: #fef08a; /* bg-yellow-200 */
            cursor: grabbing;
        }

        /* Estilo para el objeto que puedes arrastrar */
        .draggable {
            cursor: grab;
            transition: all 0.2s ease;
        }
        
        /* Estilo para la zona donde puedes soltar, cuando pasas por encima */
        .drag-over {
            border-style: dashed;
            border-color: #0ea5e9; /* border-sky-500 */
            background-color: #f0f9ff; /* bg-blue-50 */
        }

        /* 5. Estilos para el Acorde√≥n */
        .accordion-button {
            transition: background-color 0.2s ease;
        }

        /* Estilo para el bot√≥n cuando el acorde√≥n est√° activo/abierto */
        .accordion-button.active {
            background-color: #bfdbfe; /* bg-blue-200 */
            color: #1d4ed8; /* text-blue-700 */
        }

        /* Peque√±a animaci√≥n para el contenido del acorde√≥n */
        .accordion-content {
            transition: max-height 0.3s ease-out, padding 0.3s ease;
            overflow: hidden;
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
        }
        
        .accordion-content:not(.hidden) {
            max-height: 500px; /* Altura suficiente para el contenido */
            padding-top: 1rem; /* p-4 */
            padding-bottom: 1rem; /* p-4 */
        }

        /* 6. Estilos para la comprobaci√≥n del juego */
        .item-correct {
            border: 3px solid #22c55e !important; /* border-green-500 */
            background-color: #f0fdf4 !important; /* bg-green-50 */
        }
        .item-incorrect {
            border: 3px solid #ef4444 !important; /* border-red-500 */
            background-color: #fef2f2 !important; /* bg-red-50 */
        }
        /* Estilo para las im√°genes de virtud */
        .virtue-icon {
            width: 288px; /* 6 veces el tama√±o original de 48px, o el doble de 144px */
            height: 288px; /* Mantener la proporci√≥n para que sea cuadrada */
            margin: 0 auto; /* Centrar la imagen */
            object-fit: contain; /* Asegura que la imagen completa se vea dentro de su espacio */
        }
        /* Hacer la secci√≥n de botones cuadrada y que las im√°genes se adapten */
        #virtue-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            width: 100%;
            padding-bottom: 100%; /* Truco para hacer el contenedor cuadrado */
            position: relative; /* Necesario para el truco de padding-bottom */
            height: 0; /* Necesario para el truco de padding-bottom */
            align-items: stretch; /* Estirar los items para que ocupen todo el espacio */
        }
        #virtue-buttons .virtue-button {
            position: absolute; /* Posicionamiento absoluto dentro del contenedor cuadrado */
            width: calc(50% - 0.5rem); /* Ancho para dos columnas con gap */
            height: calc(50% - 0.5rem); /* Altura para dos filas con gap */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0; /* Quitar padding interno para maximizar imagen */
            transition: all 0.2s ease;
        }
        #virtue-buttons .virtue-button:nth-child(1) { top: 0; left: 0; }
        #virtue-buttons .virtue-button:nth-child(2) { top: 0; right: 0; }
        #virtue-buttons .virtue-button:nth-child(3) { bottom: 0; left: 0; }
        #virtue-buttons .virtue-button:nth-child(4) { bottom: 0; right: 0; }
        /* Ajustes para el logo en el header */
        .header-content {
            display: flex;
            align-items: center;
            justify-content: center; /* Centrar el contenido principal del header */
            position: relative; /* Para posicionar el logo absolutamente */
            max-width: 900px; /* Ancho m√°ximo para el contenido del header */
            margin: 0 auto;
        }
        .header-logo {
            position: absolute;
            left: -100px; /* Ajusta este valor para mover m√°s a la izquierda, puedes experimentar */
            height: 180px; /* Logo 3 veces m√°s grande (original 60px * 3 = 180px) */
            width: auto; /* Mantener la proporci√≥n */
            top: 50%; /* Centrar verticalmente */
            transform: translateY(-50%); /* Ajuste fino para centrar */
        }
        /* Ajustar el padding izquierdo del contenedor de texto para evitar solapamiento */
        .header-text-container {
            padding-left: 100px; /* Ajusta esto seg√∫n el tama√±o del logo y su posici√≥n */
        }
        /* Reducir el tama√±o de las letras del encabezado */
        .header-content h1 {
            font-size: 3rem; /* Equivalente a text-4xl de Tailwind, ajustado */
        }
        .header-content p {
            font-size: 1.25rem; /* Equivalente a text-xl de Tailwind, ajustado */
        }

        /* Estilos para el Modal de Recompensa */
        .modal {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 90%;
            width: 500px;
            position: relative;
        }
        .modal-close-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6b7280; /* text-gray-500 */
        }
         #reward-video {
            width: 100%;
            max-height: 70vh; /* Limitar altura del video */
            border-radius: 0.5rem;
        }


        @media (max-width: 768px) {
            .header-logo {
                height: 80px; /* M√°s grande que antes en m√≥viles (original 40px * 2 = 80px) */
                left: 1rem; /* Margen en m√≥viles */
                position: relative; /* Cambiar a relativo para flujo normal en m√≥viles */
                transform: none; /* Quitar transformaci√≥n vertical en m√≥viles */
                margin-bottom: 1rem; /* A√±adir espacio debajo del logo */
            }
            .header-content {
                flex-direction: column; /* Apilar en m√≥viles */
                text-align: center;
                padding-left: 0; /* Quitar padding izquierdo en m√≥viles */
            }
            .header-text-container {
                padding-left: 0; /* Quitar padding izquierdo en m√≥viles */
            }
            .header-content h1 {
                font-size: 2.5rem; /* Ajustar para m√≥viles */
            }
            .header-content p {
                font-size: 1rem; /* Ajustar para m√≥viles */
            }
            /* Ajustes para m√≥viles en la secci√≥n de virtudes */
            #virtue-buttons {
                padding-bottom: 0; /* Desactivar truco cuadrado en m√≥viles para mejor flujo */
                height: auto; /* Permitir altura autom√°tica */
                position: relative; /* Mantener relativo para posicionamiento de hijos */
                grid-template-columns: 1fr; /* Una columna en m√≥viles */
                gap: 1rem;
            }
            #virtue-buttons .virtue-button {
                position: relative; /* Restaurar posicionamiento relativo */
                width: 100%; /* Ocupar todo el ancho */
                height: auto; /* Altura autom√°tica */
                top: auto; left: auto; right: auto; bottom: auto; /* Eliminar posiciones fijas */
                padding: 1rem; /* Restaurar padding para un mejor toque en m√≥viles */
            }
            .virtue-icon {
                width: 96px; /* Ajuste para m√≥viles, 2 veces el original */
                height: 96px;
            }
        }
    </style>
</head>
<body class="bg-blue-50">

    <!-- Encabezado Heroico --><header class="bg-gradient-to-r from-blue-600 to-cyan-500 text-white p-8 md:p-12 text-center shadow-lg rounded-b-3xl relative overflow-hidden">
        <div class="header-content">
            <img src="https://github.com/GuillermoOseguera/Estoico/blob/main/logo.png?raw=true" alt="Logo Estoico" class="header-logo">
            <div class="header-text-container">
                <h1 class="font-black mb-4">¬°Convi√©rtete en un Superh√©roe de la Mente! ü¶∏‚Äç‚ôÇÔ∏èüß†</h1>
                <p class="font-light max-w-3xl mx-auto">Elias: Descubre los secretos de los Estoicos: sabios antiguos que eran como superh√©roes de la vida real.</p>
            </div>
        </div>
    </header>

    <!-- Contenedor Principal --><main class="max-w-6xl mx-auto p-4 md:p-8 space-y-12 md:space-y-16">

        <!-- Secci√≥n 1: ¬øQui√©nes eran los Estoicos? --><section class="bg-white rounded-2xl shadow-lg p-6 md:p-8 transform transition hover:scale-[1.02] duration-300">
            <h2 class="text-3xl font-bold text-blue-700 mb-4">Los Sabios Antiguos üèõÔ∏è</h2>
            <p class="text-lg leading-relaxed">
                "Hace much√≠simo tiempo, en la antigua Grecia, hab√≠a un grupo de personas muy inteligentes que se hac√≠an preguntas importantes: ¬øC√≥mo puedo ser feliz? ¬øC√≥mo puedo ser valiente cuando tengo miedo? ¬øQu√© puedo hacer cuando algo malo me pasa?
            </p>
            <p class="text-lg leading-relaxed mt-4">
                Estos pensadores se llamaban <strong>Estoicos</strong>, y descubrieron secretos incre√≠bles sobre c√≥mo vivir bien. ¬°Y lo mejor es que estos secretos funcionan igual de bien hoy que hace miles de a√±os!"
            </p>
        </section>

        <!-- Secci√≥n 2: Juego Interactivo "Las Dos Cajas" --><section class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
            <h2 class="text-3xl font-bold text-center text-blue-700 mb-2">Tu Primer Superpoder: La Regla de las Dos Cajas ‚ö°</h2>
            <p class="text-lg text-center mb-6">¬°Vamos a jugar! Arrastra cada situaci√≥n a la caja correcta.</p>
            <p class="text-center mb-6 font-semibold">La regla de oro: ¬°Solo enf√≥cate en lo que est√° en la caja verde! Lo de la caja roja, d√©jalo ir.</p>
            <p id="streak-counter" class="text-center text-lg font-bold text-purple-700 mb-4">Racha de aciertos perfectos: 0</p>
            
            <div class="flex flex-col md:flex-row gap-6">
                <!-- Columna de Preocupaciones --><div class="w-full md:w-1/3">
                    <h3 class="text-xl font-bold text-center mb-4 p-3 bg-gray-200 rounded-lg">Arrastra estas 7 situaciones üëá</h3>
                    <div id="worries-list" class="space-y-3 p-4 bg-gray-50 rounded-lg min-h-[450px]">
                        <!-- Los 7 elementos aleatorios se insertar√°n aqu√≠ --></div>
                    <!-- Botones de Acci√≥n --><div class="mt-4 space-y-3">
                        <button id="check-button" class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg shadow hover:bg-green-700 transition duration-200">
                            ¬°Comprobar Respuestas!
                        </button>
                        <button id="reset-button" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg shadow hover:bg-blue-700 transition duration-200">
                            ¬°Reiniciar Juego!
                        </button>
                        <!-- √Årea de Resultados --><div id="results-area" class="hidden text-center text-xl font-bold p-3 bg-yellow-100 border border-yellow-300 rounded-lg">
                            <!-- El resultado se insertar√° aqu√≠ --></div>
                    </div>
                </div>

                <!-- Columna de Cajas (Zonas de Soltar) --><div class="w-full md:w-2/3 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Caja Verde --><div class="bg-green-100 rounded-lg border-4 border-green-500 shadow-inner">
                        <h3 class="text-xl font-bold text-center p-4 bg-green-500 text-white rounded-t-md">‚úÖ PUEDO CONTROLARLO ‚úÖ</h3>
                        <div id="box-green" class="drop-zone min-h-[300px] p-4 space-y-3">
                            <!-- Aqu√≠ caen las cosas --></div>
                    </div>
                    <!-- Caja Roja --><div class="bg-red-100 rounded-lg border-4 border-red-500 shadow-inner">
                        <h3 class="text-xl font-bold text-center p-4 bg-red-500 text-white rounded-t-md">‚ùå NO PUEDO CONTROLARLO ‚ùå</h3>
                        <div id="box-red" class="drop-zone min-h-[300px] p-4 space-y-3">
                            <!-- Aqu√≠ caen las cosas --></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- (¬°NUEVA SECCI√ìN!) Secci√≥n 3: El Desaf√≠o de las 4 Virtudes --><section class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
            <h2 class="text-3xl font-bold text-center text-blue-700 mb-6">Secci√≥n 3: El Desaf√≠o de las 4 Virtudes ‚öîÔ∏è</h2>
            <p class="text-lg text-center mb-8">¬°Hora del desaf√≠o, El√≠as! Te enfrentar√°s a situaciones reales. Elige el "superpoder" (la virtud) que mejor te ayudar√≠a a manejarla.</p>
            
            <div id="virtue-quiz" class="max-w-3xl mx-auto bg-gray-50 p-6 rounded-lg shadow-inner">
                <!-- Escenario --><div class="mb-6 min-h-[100px]">
                    <p id="scenario-text" class="text-xl text-center font-medium text-gray-800">Cargando desaf√≠o...</p>
                </div>

                <!-- Botones de Virtud --><div id="virtue-buttons" class="gap-4 mb-6">
                    <button data-virtue="sabiduria" class="virtue-button bg-yellow-400 hover:bg-yellow-500 text-yellow-900 p-4 rounded-lg shadow transition duration-200 transform hover:scale-105">
                        <img src="https://github.com/GuillermoOseguera/Estoico/blob/main/Sabiduria.png?raw=true" alt="B√∫ho de Sabidur√≠a" class="virtue-icon">
                        <!-- <span class="block text-xl font-bold">Sabidur√≠a</span> --></button>
                    <button data-virtue="coraje" class="virtue-button bg-red-400 hover:bg-red-500 text-red-900 p-4 rounded-lg shadow transition duration-200 transform hover:scale-105">
                        <img src="https://github.com/GuillermoOseguera/Estoico/blob/main/Coraje.png?raw=true" alt="Le√≥n de Coraje" class="virtue-icon">
                        <!-- <span class="block text-xl font-bold">Coraje</span> --></button>
                    <button data-virtue="justicia" class="virtue-button bg-blue-400 hover:bg-blue-500 text-blue-900 p-4 rounded-lg shadow transition duration-200 transform hover:scale-105">
                        <img src="https://github.com/GuillermoOseguera/Estoico/blob/main/Justicia.png?raw=true" alt="Balanza de Justicia" class="virtue-icon">
                        <!-- <span class="block text-xl font-bold">Justicia</span> --></button>
                    <button data-virtue="templanza" class="virtue-button bg-green-400 hover:bg-green-500 text-green-900 p-4 rounded-lg shadow transition duration-200 transform hover:scale-105">
                        <img src="https://github.com/GuillermoOseguera/Estoico/blob/main/Templanza.png?raw=true" alt="Persona Meditando de Templanza" class="virtue-icon">
                        <!-- <span class="block text-xl font-bold">Templanza</span> --></button>
                </div>

                <!-- Feedback --><div id="virtue-feedback" class="min-h-[100px] p-4 rounded-lg text-center text-lg font-medium hidden">
                    <!-- El feedback ir√° aqu√≠ --></div>

                <!-- Bot√≥n de Siguiente --><button id="next-challenge-button" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg shadow hover:bg-indigo-700 transition duration-200 hidden mt-4">
                    Siguiente Desaf√≠o
                </button>
            </div>
        </section>

        <!-- Secci√≥n 4: Historias de H√©roes Legendarios (Antes S3) --><section>
            <h2 class="text-3xl font-bold text-center text-blue-700 mb-4">Secci√≥n 4: Historias de H√©roes Legendarios ‚ú®</h2>
            
            <!-- Selector de Historias --><div class="max-w-md mx-auto mb-8">
                <label for="story-selector" class="block text-lg font-medium text-center text-gray-700 mb-2">Elige una historia para leer:</label>
                <select id="story-selector" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <!-- Las opciones se cargar√°n con JavaScript --></select>
            </div>

            <!-- Contenedor de la Historia (Imagen + Texto) --><div class="bg-white rounded-2xl shadow-lg p-6 md:p-8 flex flex-col md:flex-row gap-8 items-center">
                <!-- Columna de la Imagen (EST√ÅTICA) --><div class="w-full md:w-1/2 flex-shrink-0">
                    <img src="https://github.com/GuillermoOseguera/Estoico/blob/main/cuentos.png?raw=true" alt="Ilustraci√≥n de cuentos y aventuras" class="w-full h-auto rounded-lg shadow-md object-cover">
                </div>
                <!-- Columna del Texto (DIN√ÅMICA) --><div id="story-content-wrapper" class="w-full md:w-1/2 flex flex-col min-h-[300px]">
                    <!-- El contenido de la historia (t√≠tulo, p√°rrafos, lecci√≥n) se cargar√° aqu√≠ --></div>
            </div>
        </section>

        <!-- Secci√≥n 5: Entrenamiento (Antes S4) --><section class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
            <h2 class="text-3xl font-bold text-center text-blue-700 mb-6">Secci√≥n 5: ¬°Comienza tu Entrenamiento de H√©roe! üéØ</h2>
            <p class="text-lg text-center mb-6">¬°Elias, lleg√≥ la hora de tu entrenamiento! Un superh√©roe de la mente practica todos los d√≠as. ¬°Haz clic en estas misiones para ver tus desaf√≠os!</p>
            <div id="accordion" class="space-y-4">
                <!-- Misi√≥n 1: Diario --><div>
                    <button class="accordion-button w-full text-left text-xl font-bold p-5 bg-blue-100 rounded-lg shadow hover:bg-blue-200 focus:outline-none flex justify-between items-center">
                        <span>Misi√≥n 1: El Diario del H√©roe (5 min) üìì</span>
                        <span class="arrow text-2xl font-bold">+</span>
                    </button>
                    <div class="accordion-content hidden bg-gray-50 p-4 rounded-b-lg border border-t-0 border-gray-200">
                        <p>Cada noche, responde estas tres preguntas en un cuaderno:</p>
                        <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                            <li>¬øQu√© hice bien hoy? (¬°Celebra tus victorias!)</li>
                            <li>¬øQu√© podr√≠a hacer mejor ma√±ana? (¬°Siempre aprendiendo!)</li>
                            <li>¬øPor qu√© cosa estoy agradecido? (¬°Encuentra lo bueno!)</li>
                        </ul>
                    </div>
                </div>
                <!-- Misi√≥n 2: Juego Y Qu√© Si --><div>
                    <button class="accordion-button w-full text-left text-xl font-bold p-5 bg-blue-100 rounded-lg shadow hover:bg-blue-200 focus:outline-none flex justify-between items-center">
                        <span>Misi√≥n 2: El Juego de "¬øY Qu√© Si?" ü§î</span>
                        <span class="arrow text-2xl font-bold">+</span>
                    </button>
                    <div class="accordion-content hidden bg-gray-50 p-4 rounded-b-lg border border-t-0 border-gray-200">
                        <p>Cuando algo te preocupa, juega este juego en tu mente:</p>
                        <ul class="list-none mt-2 space-y-1">
                            <li><strong>T√∫:</strong> "Me preocupa reprobar el examen."</li>
                            <li><strong>Preg√∫ntate:</strong> "<em>¬øY qu√© si repruebo?</em>"</li>
                            <li><strong>T√∫:</strong> "Estudiar√© m√°s la pr√≥xima vez."</li>
                            <li><strong>Preg√∫ntate:</strong> "<em>¬øEso ser√≠a el fin del mundo?</em>"</li>
                            <li><strong>T√∫:</strong> "No, solo tendr√≠a que esforzarme m√°s."</li>
                        </ul>
                        <p class="mt-2 font-medium">¬°Ver√°s que la mayor√≠a de tus preocupaciones no son tan terribles como parecen!</p>
                    </div>
                </div>
                <!-- Misi√≥n 3: Bondad Secreta --><div>
                    <button class="accordion-button w-full text-left text-xl font-bold p-5 bg-blue-100 rounded-lg shadow hover:bg-blue-200 focus:outline-none flex justify-between items-center">
                        <span>Misi√≥n 3: La Misi√≥n Secreta de Bondad ü§´</span>
                        <span class="arrow text-2xl font-bold">+</span>
                    </button>
                    <div class="accordion-content hidden bg-gray-50 p-4 rounded-b-lg border border-t-0 border-gray-200">
                        <p>Tu misi√≥n: cada d√≠a, haz algo bueno por alguien <strong>sin que nadie se entere</strong>. Puede ser:</p>
                        <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                            <li>Ayudar a un compa√±ero con su tarea.</li>
                            <li>Recoger algo que se le cay√≥ a alguien.</li>
                            <li>Decir algo amable.</li>
                            <li>¬°Compartir tu merienda!</li>
                        </ul>
                        <p class="mt-2 font-medium">¬øPuedes hacerlo sin decirle a nadie? ¬°Ese es el verdadero desaf√≠o de un h√©roe!</p>
                    </div>
                </div>
                <!-- Misi√≥n 4: Entrenamiento de Paciencia --><div>
                    <button class="accordion-button w-full text-left text-xl font-bold p-5 bg-blue-100 rounded-lg shadow hover:bg-blue-200 focus:outline-none flex justify-between items-center">
                        <span>Misi√≥n 4: Entrenamiento de Paciencia ‚è≥</span>
                        <span class="arrow text-2xl font-bold">+</span>
                    </button>
                    <div class="accordion-content hidden bg-gray-50 p-4 rounded-b-lg border border-t-0 border-gray-200">
                        <p>¬°Los estoicos practicaban el autocontrol! Prueba estos mini-desaf√≠os:</p>
                        <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                            <li>Espera 5 minutos antes de pedir un dulce.</li>
                            <li>Cuenta hasta 10 cuando est√©s enojado antes de reaccionar.</li>
                            <li>Termina tu tarea antes de jugar, aunque no quieras.</li>
                            <li>Escucha completamente a alguien sin interrumpir.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- Secci√≥n 6: Actividad Final (Antes S5) --><section class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
            <h2 class="text-3xl font-bold text-center text-blue-700 mb-6">Secci√≥n 6: ¬°Dise√±a tu Escudo Estoico! üõ°Ô∏è</h2>
            <p class="text-lg text-center mb-4">
                El√≠as, un verdadero h√©roe necesita su propio escudo. ¬°Aqu√≠ te dejamos un ejemplo para que te inspires al crear el tuyo! 
                Recuerda que tu escudo representar√° los "superpoderes" que los estoicos nos ense√±an.
            </p>
            <div class="flex justify-center mb-6">
                <img src="https://github.com/GuillermoOseguera/Estoico/blob/main/escudo%20estoico.png?raw=true" alt="Ejemplo de Escudo Estoico" class="max-w-full h-auto rounded-lg shadow-md border-2 border-gray-300">
            </div>
            <p class="text-lg text-center mt-6">
                ¬°Ahora es tu turno! Dibuja tu propio escudo dividido en cuatro partes, y en cada una, dibuja o escribe un s√≠mbolo
                para la Sabidur√≠a (como un b√∫ho), el Coraje (como un le√≥n), la Justicia (como una balanza) y la Templanza (como una persona meditando).
                ¬°Este ser√° tu escudo de h√©roe estoico, listo para recordarte tus poderes cuando enfrentes cualquier desaf√≠o!
            </p>
        </section>

        <!-- Resumen Final --><footer class="bg-gradient-to-r from-blue-700 to-cyan-600 text-white p-8 md:p-12 text-center shadow-lg rounded-2xl">
            <h2 class="text-3xl font-black mb-4">Resumen de H√©roe üåü</h2>
            <p id="footer-quote" class="text-xl font-light mb-4">Cargando frase de h√©roe...</p>
            <p class="text-lg font-semibold">Recuerda: ¬°No puedes controlar lo que pasa, pero S√ç puedes controlar c√≥mo reaccionas!</p>
        </footer>

    </main>

    <!-- Modal de Recompensa (Oculto por defecto) --><div id="reward-modal" class="modal">
        <div class="modal-content">
            <button id="close-modal-button" class="modal-close-button">&times;</button>
            <div id="reward-message-container">
                 <h3 class="text-2xl font-bold text-green-600 mb-4">¬°Felicidades, H√©roe! üéâ</h3>
                <p class="text-lg mb-6">Genial, tuviste 7 aciertos 3 veces seguidas, eso se merece un premio. Da click en el bot√≥n para obtener tu recompensa.</p>
                <button id="reward-button" class="bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow hover:bg-purple-700 transition duration-200">
                    ¬°Ver Recompensa!
                </button>
            </div>
            <div id="reward-video-container" class="hidden mt-4">
                 <video id="reward-video" controls>
                    <source src="https://raw.githubusercontent.com/GuillermoOseguera/Estoico/main/videoelias.mp4" type="video/mp4">
                    Tu navegador no soporta el video MP4.
                </video>
            </div>
        </div>
    </div>

    <!-- Script para Confeti (Fuente: https://www.jsdelivr.com/package/npm/canvas-confetti) --><script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

    <script>
        // --- L√ìGICA PARA EL ACORDE√ìN ---
        document.addEventListener('DOMContentLoaded', () => {
            const accordionButtons = document.querySelectorAll('.accordion-button');
            
            accordionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const content = button.nextElementSibling;
                    const arrow = button.querySelector('.arrow');

                    // Alternar visibilidad del contenido
                    content.classList.toggle('hidden');
                    
                    // Alternar estado activo del bot√≥n
                    if (content.classList.contains('hidden')) {
                        button.classList.remove('active');
                        arrow.textContent = '+';
                    } else {
                        button.classList.add('active');
                        arrow.textContent = '‚àí'; // Usar un signo menos
                    }
                });
            });

            // --- L√ìGICA PARA ARRASTRAR Y SOLTAR (DRAG & DROP) ---
            
            // PASO 1: Definir la base de datos de todas las preocupaciones (m√°s de 100)
            const allWorries = [
                // Contexto: General (14 a√±os)
                { text: "Mi reacci√≥n si saco una mala nota", correctBox: "green" },
                { text: "El tema que vendr√° en el examen", correctBox: "red" },
                { text: "Cu√°ntas horas estudio para el examen", correctBox: "green" },
                { text: "Lo que mis amigos piensan de mi ropa", correctBox: "red" },
                { text: "Ser honesto con mis padres", correctBox: "green" },
                { text: "Que me inviten a una fiesta", correctBox: "red" },
                { text: "Pedir ayuda en una materia que me cuesta", correctBox: "green" },
                { text: "Lo que otros postean en redes sociales", correctBox: "red" },
                { text: "Lo que *yo* decido postear en redes", correctBox: "green" },
                { text: "Acostarme a una hora razonable", correctBox: "green" },
                { text: "Tener m√°s talento natural que otros", correctBox: "red" },
                { text: "Mi esfuerzo en practicar algo", correctBox: "green" },
                { text: "Si la pel√≠cula que quiero ver es buena", correctBox: "red" },
                { text: "Elegir qu√© ropa ponerme hoy", correctBox: "green" },
                { text: "El tr√°fico en el camino a la escuela", correctBox: "red" },
                { text: "Mi actitud ante el tr√°fico", correctBox: "green" },
                { text: "Que mis compa√±eros me hagan re√≠r en clase", correctBox: "red" },
                { text: "Mi decisi√≥n de prestar atenci√≥n en clase", correctBox: "green" },
                { text: "La popularidad de un influencer", correctBox: "red" },
                { text: "La limpieza de mi habitaci√≥n", correctBox: "green" },
                { text: "El clima de hoy", correctBox: "red" },
                { text: "Prepararme para un d√≠a lluvioso", correctBox: "green" },
                { text: "Que me regalen algo que no me gusta", correctBox: "red" },
                { text: "Agradecer por un regalo, aunque no me guste", correctBox: "green" },
                { text: "El precio de mi juego favorito", correctBox: "red" },
                { text: "Ahorrar para comprar un juego", correctBox: "green" },
                { text: "Las opiniones pol√≠ticas de otras personas", correctBox: "red" },
                { text: "Formarme mi propia opini√≥n", correctBox: "green" },
                { text: "Que alguien me hable mal", correctBox: "red" },
                { text: "C√≥mo respondo a alguien que me habla mal", correctBox: "green" },
                { text: "Mi nivel de energ√≠a por la ma√±ana", correctBox: "red" },
                { text: "Decidir si desayuno bien o no", correctBox: "green" },
                { text: "La cantidad de tarea que me dejan", correctBox: "red" },
                { text: "Hacer la tarea con esfuerzo y a tiempo", correctBox: "green" },
                { text: "El ruido de mis vecinos", correctBox: "red" },
                { text: "Buscar un lugar tranquilo para estudiar", correctBox: "green" },
                { text: "Si un video se hace viral", correctBox: "red" },
                { text: "La calidad de los videos que hago", correctBox: "green" },
                { text: "Que me critiquen en un juego online", correctBox: "red" },
                { text: "Mi reacci√≥n a una cr√≠tica en un juego", correctBox: "green" },
                { text: "Mi estado de √°nimo general", correctBox: "red" }, // Puede ser influido, pero el control directo es limitado
                { text: "Hacer actividades que mejoren mi √°nimo", correctBox: "green" },
                { text: "Si mi banda favorita se separa", correctBox: "red" },
                { text: "Disfrutar la m√∫sica que ya existe", correctBox: "green" },
                { text: "La calidad de la comida en la cafeter√≠a", correctBox: "red" },
                { text: "Elegir opciones saludables en la cafeter√≠a", correctBox: "green" },
                { text: "Que me toque el asiento de al lado de alguien ruidoso", correctBox: "red" },
                { text: "Mi concentraci√≥n a pesar del ruido", correctBox: "green" },
                { text: "Las decisiones del director de la escuela", correctBox: "red" },
                { text: "Seguir las reglas de la escuela", correctBox: "green" },

                // Contexto: Futbol
                { text: "Mi actitud si pierdo el partido de futbol", correctBox: "green" },
                { text: "Que el entrenador me ponga de titular", correctBox: "red" },
                { text: "El resultado final del partido", correctBox: "red" },
                { text: "El esfuerzo que pongo en el entrenamiento", correctBox: "green" },
                { text: "Felicitar al otro equipo si nos ganan", correctBox: "green" },
                { text: "Que llueva el d√≠a del partido", correctBox: "red" },
                { text: "El talento de los jugadores del otro equipo", correctBox: "red" },
                { text: "El tiempo que dedico a practicar tiros libres", correctBox: "green" },
                { text: "Las decisiones del √°rbitro", correctBox: "red" },
                { text: "Mi respeto hacia el √°rbitro", correctBox: "green" },
                { text: "El estado del campo de juego", correctBox: "red" },
                { text: "Ajustar mi juego al estado del campo", correctBox: "green" },
                { text: "Si mis compa√±eros meten goles", correctBox: "red" },
                { text: "Animar a mis compa√±eros", correctBox: "green" },
                { text: "El color del uniforme del equipo contrario", correctBox: "red" },
                { text: "Mi concentraci√≥n en el juego", correctBox: "green" },
                { text: "Una lesi√≥n inesperada de un compa√±ero", correctBox: "red" },
                { text: "Ayudar a un compa√±ero lesionado", correctBox: "green" },
                { text: "Las t√°cticas que el entrenador decida", correctBox: "red" },
                { text: "Ejecutar las t√°cticas lo mejor posible", correctBox: "green" },

                // Contexto: Familia (Jari, Elisa, Paco, Estela)
                { text: "Ser paciente con mi hermana Elisa", correctBox: "green" },
                { text: "Que Elisa me pida usar mi Switch", correctBox: "red" },
                { text: "Mi reacci√≥n si Elisa me molesta", correctBox: "green" },
                { text: "Ayudar a mi mam√° Jari en la casa", correctBox: "green" },
                { text: "Que mi mam√° Jari est√© de mal humor", correctBox: "red" },
                { text: "Cumplir con lo que le promet√≠ a mi mam√° Jari", correctBox: "green" },
                { text: "Visitar a mi abuelo Paco", correctBox: "green" },
                { text: "Lo que mi abuelo Paco opina de mi m√∫sica", correctBox: "red" },
                { text: "Preguntarle a mi abuelo Paco sobre sus historias", correctBox: "green" },
                { text: "Que mi mam√° (Jari) me d√© permiso para salir", correctBox: "red" },
                { text: "Ayudar a mi abuela Estela con el jard√≠n", correctBox: "green" },
                { text: "Lo que mi abuela Estela cocine hoy", correctBox: "red" },
                { text: "Ser amable con mis primos", correctBox: "green" },
                { text: "Que mis t√≠os visiten sin avisar", correctBox: "red" },
                { text: "Mi actitud si tenemos visitas inesperadas", correctBox: "green" },
                { text: "Recordar el cumplea√±os de un familiar", correctBox: "green" },
                { text: "Si mi familia se muda lejos", correctBox: "red" },
                { text: "Mantenerme en contacto con mi familia", correctBox: "green" },
                { text: "Las discusiones entre mis padres", correctBox: "red" },
                { text: "Mi comportamiento durante una discusi√≥n familiar", correctBox: "green" },

                // Contexto: Videojuegos (Sonic, Minecraft, Switch)
                { text: "Terminar mis tareas antes de jugar Minecraft", correctBox: "green" },
                { text: "Que haya lag en la partida de Sonic", correctBox: "red" },
                { text: "El tiempo que decido jugar Switch", correctBox: "green" },
                { text: "Que un creeper explote mi casa en Minecraft", correctBox: "red" },
                { text: "Mi reacci√≥n si un creeper lo explota todo", correctBox: "green" },
                { text: "Ahorrar para comprar un nuevo juego de Switch", correctBox: "green" },
                { text: "Un bug que arruina mi partida", correctBox: "red" },
                { text: "Lo que opinan mis amigos de mi mundo en Minecraft", correctBox: "red" },
                { text: "Que se vaya el internet mientras juego", correctBox: "red" },
                { text: "Cuidar bien mi Nintendo Switch", correctBox: "green" },
                { text: "El anuncio de un nuevo juego de Sonic", correctBox: "red" },
                { text: "Mi comportamiento justo en un juego online", correctBox: "green" },
                { text: "Que un tramposo gane en mi juego favorito", correctBox: "red" },
                { text: "Reportar a un tramposo", correctBox: "green" },
                { text: "La dificultad de un nivel de juego", correctBox: "red" },
                { text: "Mi persistencia para pasar un nivel dif√≠cil", correctBox: "green" },
                { text: "Los gr√°ficos de un juego viejo", correctBox: "red" },
                { text: "Disfrutar la historia o la jugabilidad de un juego", correctBox: "green" },
                { text: "Que mis amigos prefieran otro juego", correctBox: "red" },
                { text: "Estar abierto a probar nuevos juegos", correctBox: "green" },

                // Contexto: Actividades (Nataci√≥n, Karate)
                { text: "Ir a nataci√≥n aunque est√© cansado", correctBox: "green" },
                { text: "Ser el m√°s r√°pido de la alberca", correctBox: "red" },
                { text: "Mi esfuerzo en la clase de nataci√≥n", correctBox: "green" },
                { text: "Lo que opinaban mis amigos de que hac√≠a karate", correctBox: "red" },
                { text: "Decidir si quiero probar karate otra vez", correctBox: "green" },
                { text: "Aplicar la disciplina que aprend√≠ en karate", correctBox: "green" },
                { text: "El estilo de nadar de mis compa√±eros", correctBox: "red" },
                { text: "Mi concentraci√≥n en los ejercicios de karate", correctBox: "green" },
                { text: "Si la clase de nataci√≥n se cancela", correctBox: "red" },
                { text: "Buscar otra forma de hacer ejercicio si se cancela la clase", correctBox: "green" },
                { text: "El tama√±o de los oponentes en karate", correctBox: "red" },
                { text: "Mi t√©cnica en karate, no solo la fuerza", correctBox: "green" },
                { text: "Ganar una medalla en nataci√≥n", correctBox: "red" },
                { text: "Mejorar mi tiempo en nataci√≥n", correctBox: "green" },
                { text: "El equipo de nataci√≥n que me toca", correctBox: "red" },
                { text: "Ser un buen compa√±ero de equipo", correctBox: "green" },
                { text: "Que mi instructor me corrija mucho", correctBox: "red" },
                { text: "Aceptar las correcciones de mi instructor", correctBox: "green" },
                { text: "El n√∫mero de cinturones que tengo en karate", correctBox: "red" },
                { text: "Mi progreso en las katas de karate", correctBox: "green" }
            ];

            // PASO 2: Obtener elementos del DOM (Juego Drag & Drop)
            const dropZones = document.querySelectorAll('.drop-zone');
            const worriesList = document.getElementById('worries-list');
            const resetButton = document.getElementById('reset-button');
            const checkButton = document.getElementById('check-button');
            const resultsArea = document.getElementById('results-area');
            let draggables = []; // Se llenar√° din√°micamente
            let consecutivePerfectScores = 0; // NUEVO: Contador de rachas
            const streakCounterEl = document.getElementById('streak-counter'); // NUEVO: Elemento para mostrar la racha

            // PASO 3: Funci√≥n para mezclar el array (Fisher-Yates)
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            // PASO 4: Funci√≥n para (re)poblar la lista de 7 elementos
            function populateWorriesList() {
                worriesList.innerHTML = ''; // Limpiar lista
                // Limpiar cajas
                document.getElementById('box-green').innerHTML = '';
                document.getElementById('box-red').innerHTML = '';

                shuffleArray(allWorries);
                const randomWorries = allWorries.slice(0, 7);

                randomWorries.forEach((worry, index) => {
                    const div = document.createElement('div');
                    const id = `worry${index + 1}`; // ID √∫nico para el drag-and-drop
                    div.id = id;
                    const class_base = "draggable bg-white p-4 rounded-lg shadow border border-gray-200 text-center font-medium";
                    div.setAttribute('class_base', class_base);
                    div.className = class_base;
                    div.setAttribute('draggable', 'true');
                    div.setAttribute('data-correct-box', worry.correctBox);
                    div.textContent = worry.text;
                    worriesList.appendChild(div);
                });

                // Ocultar y limpiar resultados
                resultsArea.textContent = '';
                resultsArea.classList.add('hidden');
                // Actualizar contador visual de racha
                 if (streakCounterEl) streakCounterEl.textContent = `Racha de aciertos perfectos: ${consecutivePerfectScores}`;
            }

            // PASO 5: Funci√≥n para (re)configurar los listeners de drag/drop
            function setupDraggables() {
                // (Re)seleccionar los draggables
                draggables = document.querySelectorAll('[draggable="true"]');
                
                // 1. A√±adir listeners a los elementos arrastrables
                draggables.forEach(draggable => {
                    draggable.addEventListener('dragstart', (e) => {
                        draggable.classList.add('dragging');
                        e.dataTransfer.setData('text/plain', draggable.id);
                    });
                    
                    draggable.addEventListener('dragend', () => {
                        draggable.classList.remove('dragging');
                    });
                });
            }

            // PASO 6: Configurar las zonas de soltar (solo se hace una vez)
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault(); // ¬°Muy importante! Permite que se pueda "soltar"
                    zone.classList.add('drag-over');
                });

                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('drag-over');
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');
                    const id = e.dataTransfer.getData('text/plain');
                    const draggableElement = document.getElementById(id);
                    if (draggableElement) {
                        zone.appendChild(draggableElement);
                        // Limpiar el feedback de correcto/incorrecto al moverlo
                        draggableElement.className = draggableElement.getAttribute('class_base');
                        // Ocultar resultados si se mueve algo despu√©s de comprobar
                        resultsArea.classList.add('hidden');
                    }
                });
            });

            // PASO 7: L√≥gica del bot√≥n de comprobar (MODIFICADO para racha y modal)
            checkButton.addEventListener('click', () => {
                let correctCount = 0;
                const totalItems = draggables.length;
                let allPlaced = true; // Variable para verificar si todos los items est√°n en alguna caja

                 // Verificar si todos los items est√°n en alguna caja
                draggables.forEach(draggable => {
                    if (!draggable.parentElement || (draggable.parentElement.id !== 'box-green' && draggable.parentElement.id !== 'box-red')) {
                        allPlaced = false;
                    }
                     // Restaurar clase base para limpiar feedback anterior
                    draggable.className = draggable.getAttribute('class_base');
                });

                if (!allPlaced) {
                    resultsArea.textContent = `¬°Debes colocar todas las situaciones en alguna caja!`;
                    resultsArea.classList.remove('hidden');
                    resultsArea.className = "text-center text-xl font-bold p-3 bg-red-100 border border-red-300 rounded-lg text-red-700"; // Estilo de error
                     consecutivePerfectScores = 0; // Reiniciar racha si no complet√≥
                     if (streakCounterEl) streakCounterEl.textContent = `Racha de aciertos perfectos: ${consecutivePerfectScores}`;
                    return; // Detener la comprobaci√≥n
                }


                draggables.forEach(draggable => {
                    const correctBox = draggable.getAttribute('data-correct-box');
                    const parentBox = draggable.parentElement;
                    let isCorrect = false;

                    if (correctBox === 'green' && parentBox.id === 'box-green') {
                        isCorrect = true;
                    } else if (correctBox === 'red' && parentBox.id === 'box-red') {
                        isCorrect = true;
                    }

                    // Aplicar feedback visual
                    if (isCorrect) {
                        correctCount++;
                        draggable.classList.add('item-correct');
                    } else if (parentBox.id === 'box-green' || parentBox.id === 'box-red') {
                        draggable.classList.add('item-incorrect');
                    }
                });

                // Mostrar resultados
                resultsArea.textContent = `¬°Acertaste ${correctCount} de ${totalItems}! ${correctCount === totalItems ? 'üéâ' : 'üëç'}`;
                resultsArea.classList.remove('hidden');
                // Restaurar estilo normal de resultados
                resultsArea.className = "hidden text-center text-xl font-bold p-3 bg-yellow-100 border border-yellow-300 rounded-lg";
                resultsArea.classList.remove('hidden');


                // L√≥gica de racha y modal
                if (correctCount === totalItems) {
                    consecutivePerfectScores++;
                    // Disparar confeti por acierto perfecto
                    if (typeof confetti === 'function') { 
                        confetti({
                            particleCount: 150,
                            spread: 90,
                            origin: { y: 0.6 }
                        });
                    }
                     // Comprobar si se alcanz√≥ la racha de 3
                    if (consecutivePerfectScores >= 3) {
                        showRewardModal();
                        consecutivePerfectScores = 0; // Reiniciar racha despu√©s de mostrar el premio
                    }
                } else {
                    consecutivePerfectScores = 0; // Reiniciar racha si no fue perfecto
                }
                
                // Actualizar contador visual de racha
                 if (streakCounterEl) streakCounterEl.textContent = `Racha de aciertos perfectos: ${consecutivePerfectScores}`;

            });

            // PASO 8: L√≥gica del bot√≥n de reiniciar
            resetButton.addEventListener('click', () => {
                // Genera 7 nuevos elementos
                populateWorriesList(); 
                // Les asigna los listeners de drag-and-drop
                setupDraggables();     
                // NO reinicia la racha aqu√≠, solo si fallan en checkButton
            });

             // --- L√ìGICA PARA EL MODAL DE RECOMPENSA ---
            const rewardModal = document.getElementById('reward-modal');
            const closeModalButton = document.getElementById('close-modal-button');
            const rewardButton = document.getElementById('reward-button');
            const rewardMessageContainer = document.getElementById('reward-message-container');
            const rewardVideoContainer = document.getElementById('reward-video-container');
            const rewardVideo = document.getElementById('reward-video');

            function showRewardModal() {
                // Resetear modal al estado inicial (mensaje visible, video oculto)
                rewardMessageContainer.classList.remove('hidden');
                rewardVideoContainer.classList.add('hidden');
                rewardVideo.pause(); // Pausar video si estaba reproduci√©ndose
                rewardVideo.currentTime = 0; // Reiniciar video
                
                rewardModal.classList.add('active');
            }

            function hideRewardModal() {
                 rewardModal.classList.remove('active');
                 rewardVideo.pause(); // Pausar video al cerrar
            }

             if(closeModalButton) {
                 closeModalButton.addEventListener('click', hideRewardModal);
             }
             // Cerrar modal si se hace clic fuera del contenido
             if(rewardModal) {
                 rewardModal.addEventListener('click', (event) => {
                    if (event.target === rewardModal) {
                        hideRewardModal();
                    }
                });
            }

            if(rewardButton) {
                rewardButton.addEventListener('click', () => {
                    rewardMessageContainer.classList.add('hidden');
                    rewardVideoContainer.classList.remove('hidden');
                    rewardVideo.play().catch(error => {
                         // Autoplay puede ser bloqueado, manejar error si es necesario
                        console.error("Error al intentar reproducir video autom√°ticamente:", error);
                    });
                });
            }


            // --- L√ìGICA PARA EL DESAF√çO DE VIRTUDES ---

            // A. Base de datos de desaf√≠os (¬°AMPLIADA!)
            const allChallenges = [
                // Originales
                {
                    scenario: "Est√°s jugando Minecraft y un creeper destruye la casa que te tom√≥ horas construir. Sientes ganas de lanzar el control.",
                    correctVirtue: "templanza",
                    feedback: {
                        sabiduria: "¬°Casi! La sabidur√≠a te dir√≠a que es solo un juego, pero la Templanza es el poder espec√≠fico para *controlar* tu reacci√≥n de enojo en el momento.",
                        coraje: "No se necesita coraje aqu√≠, ya que no hay peligro. Lo que se necesita es calma.",
                        justicia: "El creeper no fue 'injusto', ¬°solo hizo lo que hacen los creepers! El poder que necesitas es el autocontrol.",
                        templanza: "¬°Correcto! La Templanza (Autocontrol) es el superpoder que usas para respirar hondo, no lanzar el control y recordar que puedes reconstruirlo."
                    }
                },
                {
                    scenario: "Tus amigos te invitan a jugar f√∫tbol, pero tienes un examen importante ma√±ana y tu abuelo Paco te aconsej√≥ estudiar.",
                    correctVirtue: "sabiduria",
                    feedback: {
                        sabiduria: "¬°Exacto! La Sabidur√≠a es el poder de ver el futuro (el examen de ma√±ana) y tomar la decisi√≥n inteligente, aunque no sea la m√°s divertida ahora.",
                        coraje: "Podr√≠a necesitarse un poco de coraje para decir 'no' a tus amigos, pero la virtud principal que usas para *decidir* es la sabidur√≠a.",
                        justicia: "No es una cuesti√≥n de justicia. Es una decisi√≥n sobre tus prioridades.",
                        templanza: "La templanza te ayudar√≠a a *no* jugar todo el d√≠a, pero la Sabidur√≠a es la que te dice *por qu√©* no deber√≠as hacerlo."
                    }
                },
                {
                    scenario: "Est√°s en el Nintendo Switch y tu hermana Elisa te exige que se lo prestes *ya mismo*. Tu primer instinto es decirle que se vaya.",
                    correctVirtue: "justicia",
                    feedback: {
                        sabiduria: "La sabidur√≠a te ayudar√≠a a planear una soluci√≥n, pero la Justicia es el poder que te recuerda *considerar* los sentimientos y derechos de Elisa.",
                        coraje: "No se requiere coraje en esta situaci√≥n.",
                        justicia: "¬°S√≠! La Justicia es el poder de ser justo con los dem√°s. Te hace preguntar: '¬øEs justo que yo juegue todo el tiempo? ¬øHicimos un trato?'. Te ayuda a encontrar una soluci√≥n justa para ambos.",
                        templanza: "Necesitas Templanza para *no* gritarle, pero la Justicia es la que te gu√≠a a *c√≥mo* actuar con ella de forma correcta."
                    }
                },
                {
                    scenario: "Tu entrenador de f√∫tbol te pide que intentes una nueva posici√≥n que te da miedo porque no sabes jugarla bien.",
                    correctVirtue: "coraje",
                    feedback: {
                        sabiduria: "La sabidur√≠a es saber que es bueno aprender cosas nuevas, pero el poder que necesitas para *superar el miedo* es el coraje.",
                        coraje: "¬°Correcto! El Coraje no es no tener miedo. Es tener miedo (a fallar, a verte mal) pero hacerlo de todos modos por un bien mayor (ayudar al equipo, aprender).",
                        justicia: "Esto no es sobre justicia, es sobre enfrentar un desaf√≠o personal.",
                        templanza: "La templanza te ayudar√≠a a no frustrarte si fallas, pero el Coraje es lo que te hace intentarlo en primer lugar."
                    }
                },
                {
                    scenario: "Tu mam√° (Jari) y tu abuela (Estela) te piden ayuda con las bolsas del s√∫per. Est√°s a punto de ganar una carrera de Sonic.",
                    correctVirtue: "justicia",
                    feedback: {
                        sabiduria: "La sabidur√≠a te dir√≠a que la familia es importante, pero la Justicia es el poder de la 'responsabilidad' y de hacer lo correcto por tu familia.",
                        coraje: "No requiere coraje, solo requiere dejar algo divertido por algo que se debe hacer.",
                        justicia: "¬°Perfecto! La Justicia tambi√©n significa ser un buen miembro de tu familia y comunidad. Pausar el juego para ayudar a Jari y Estela es la acci√≥n 'justa' y correcta.",
                        templanza: "Necesitas templanza para *no* quejarte, pero la Justicia es la que te dice *por qu√©* debes ir a ayudar."
                    }
                },
                 // Nuevos Desaf√≠os (50+)
                {
                    scenario: "Un compa√±ero se burla de tus tenis nuevos en la escuela. Te sientes avergonzado y enojado.",
                    correctVirtue: "coraje",
                    feedback: {
                        sabiduria: "La sabidur√≠a te dice que su opini√≥n no define el valor de tus tenis ni el tuyo, pero el Coraje te da la fuerza para no dejar que te afecte.",
                        coraje: "¬°S√≠! El Coraje es ignorar la burla o responder con calma, sabiendo que t√∫ vales m√°s que una opini√≥n ajena. Es no dejar que el miedo a la cr√≠tica te domine.",
                        justicia: "Aunque la burla es injusta, la virtud principal aqu√≠ es manejar tu propia reacci√≥n interna con fortaleza.",
                        templanza: "La Templanza ayuda a no reaccionar exageradamente, pero el Coraje es la fortaleza interior para no sentirte mal por la burla."
                    }
                },
                {
                    scenario: "Tienes mucha tarea, pero tus amigos te est√°n esperando online para jugar Minecraft.",
                    correctVirtue: "templanza",
                    feedback: {
                        sabiduria: "La Sabidur√≠a te dice que la tarea es importante, pero la Templanza es el superpoder del autocontrol para *hacer* primero lo que debes.",
                        coraje: "No se necesita coraje, sino disciplina.",
                        justicia: "Es una cuesti√≥n de responsabilidad personal, m√°s que de justicia hacia otros.",
                        templanza: "¬°Exacto! Templanza es resistir la tentaci√≥n de jugar ahora y tener la disciplina para terminar tus deberes primero. ¬°El juego puede esperar!"
                    }
                },
                {
                    scenario: "En nataci√≥n, ves que un compa√±ero tiene dificultades para aprender una brazada nueva y otros se r√≠en.",
                    correctVirtue: "justicia",
                    feedback: {
                        sabiduria: "La sabidur√≠a te dir√≠a que todos aprenden a ritmos diferentes, pero la Justicia te impulsa a actuar correctamente.",
                        coraje: "Podr√≠as necesitar coraje para defenderlo, pero la motivaci√≥n principal viene de la Justicia.",
                        justicia: "¬°Correcto! La Justicia es defender al que lo necesita, no participar en la burla y, si te animas, ofrecerle ayuda o √°nimo. Es tratar a los dem√°s con respeto.",
                        templanza: "La templanza ayuda a no re√≠rte t√∫, pero la Justicia te pide ir m√°s all√° y ser solidario."
                    }
                },
                {
                    scenario: "Tu abuela Estela te cuenta la misma historia por d√©cima vez. Te aburres.",
                    correctVirtue: "templanza",
                    feedback: {
                        sabiduria: "La sabidur√≠a es entender que ella disfruta cont√°ndola, pero la Templanza es el poder de la paciencia.",
                        coraje: "No se necesita coraje aqu√≠.",
                        justicia: "Podr√≠a argumentarse que es 'justo' escucharla, pero la virtud clave es el autocontrol de tu aburrimiento.",
                        templanza: "¬°Exacto! Templanza es tener la paciencia para escucharla con atenci√≥n y amabilidad, aunque ya te sepas la historia. Es controlar tu impaciencia."
                    }
                },
                 {
                    scenario: "En un partido de f√∫tbol, el √°rbitro marca una falta en tu contra que claramente no cometiste.",
                    correctVirtue: "templanza",
                    feedback: {
                        sabiduria: "La sabidur√≠a te dice que discutir no cambiar√° la decisi√≥n, pero la Templanza controla tu reacci√≥n.",
                        coraje: "Se necesita coraje para aceptar una decisi√≥n injusta sin explotar, pero la Templanza es el autocontrol directo.",
                        justicia: "La situaci√≥n es injusta, pero tu reacci√≥n debe ser controlada. La virtud principal aqu√≠ es la Templanza.",
                        templanza: "¬°Correcto! Templanza es controlar tu frustraci√≥n, no gritarle al √°rbitro y seguir jugando concentrado. Aceptar lo que no puedes cambiar (la decisi√≥n)."
                    }
                },
                {
                    scenario: "Te enteras de que un amigo habl√≥ mal de ti a tus espaldas.",
                    correctVirtue: "sabiduria",
                    feedback: {
                        sabiduria: "¬°S√≠! La Sabidur√≠a es detenerte a pensar antes de reaccionar. ¬øEs verdad? ¬øVale la pena confrontarlo? ¬øC√≥mo hacerlo de forma constructiva? Pensar antes de actuar.",
                        coraje: "Podr√≠as necesitar Coraje para hablar con √©l, pero primero necesitas Sabidur√≠a para decidir *si* debes hacerlo y *c√≥mo*.",
                        justicia: "Lo que hizo no fue justo, pero tu primera virtud a usar es la Sabidur√≠a para analizar la situaci√≥n.",
                        templanza: "Necesitas Templanza para no explotar, pero la gu√≠a principal viene de la Sabidur√≠a."
                    }
                },
                 {
                    scenario: "Quieres comprar el nuevo juego de Sonic, pero sabes que debes ahorrar para el regalo de cumplea√±os de tu mam√° Jari.",
                    correctVirtue: "templanza",
                    feedback: {
                        sabiduria: "La sabidur√≠a te dice que el regalo es importante, pero la Templanza es el autocontrol para *no* gastar el dinero ahora.",
                        coraje: "No se requiere coraje, sino disciplina financiera.",
                        justicia: "Es un acto de cari√±o hacia tu mam√°, relacionado con la Justicia (ser buen hijo), pero la virtud directa es el autocontrol.",
                        templanza: "¬°Exacto! Templanza es resistir el deseo inmediato del juego por un bien mayor a futuro (el regalo). Es autocontrol sobre tus impulsos de compra."
                    }
                },
                {
                    scenario: "Tu hermana Elisa rompe accidentalmente algo tuyo que te gustaba mucho.",
                    correctVirtue: "templanza",
                    feedback: {
                        sabiduria: "La sabidur√≠a te ayuda a entender que fue un accidente, pero la Templanza gestiona tu enojo.",
                        coraje: "No se necesita coraje aqu√≠.",
                        justicia: "Podr√≠as pedir que lo reponga si es justo, pero la primera reacci√≥n a controlar es tu enojo, usando Templanza.",
                        templanza: "¬°Correcto! Es normal sentir enojo, pero la Templanza te ayuda a respirar, no gritarle, y recordar que los accidentes pasan. Es controlar tu reacci√≥n inicial."
                    }
                },
                {
                    scenario: "Debes presentar un trabajo oral en clase y te da mucho p√°nico hablar en p√∫blico.",
                    correctVirtue: "coraje",
                    feedback: {
                        sabiduria: "La sabidur√≠a te dice que prepararte bien te ayudar√°, pero el poder para *enfrentar* el miedo es el Coraje.",
                        coraje: "¬°S√≠! El Coraje es hacer la presentaci√≥n aunque sientas miedo o nervios. Es actuar a pesar del p√°nico.",
                        justicia: "No aplica directamente aqu√≠.",
                        templanza: "La templanza te ayuda a mantener la calma *durante* la presentaci√≥n, pero el Coraje es lo que te hace subir ah√≠."
                    }
                },
                {
                    scenario: "Tu equipo de f√∫tbol pierde un partido importante por un error tuyo.",
                    correctVirtue: "coraje",
                    feedback: {
                        sabiduria: "La sabidur√≠a te dice que todos cometen errores y que puedes aprender de esto, pero el Coraje te ayuda a afrontarlo.",
                        coraje: "¬°Exacto! Coraje es aceptar tu error, no esconderte ni culpar a otros, y seguir entrenando para mejorar. Es la fortaleza para enfrentar la decepci√≥n.",
                        justicia: "No es sobre justicia, es sobre asumir responsabilidad.",
                        templanza: "La templanza te ayuda a no hundirte en la tristeza, pero el Coraje es la fuerza para levantarte despu√©s del error."
                    }
                },
                {
                    scenario: "Est√°s muy cansado despu√©s de nataci√≥n y no quieres hacer la tarea.",
                    correctVirtue: "templanza",
                     feedback: { sabiduria:"La Sabidur√≠a te dice que es mejor hacerla ahora.", coraje:"No se requiere coraje.", justicia:"Es justo contigo mismo cumplir.", templanza:"¬°S√≠! Templanza es la disciplina para hacer lo que debes, aunque est√©s cansado." }
                },
                {
                    scenario: "Un amigo te presiona para hacer algo que sabes que est√° mal (ej. copiar en examen).",
                    correctVirtue: "coraje",
                     feedback: { sabiduria:"La Sabidur√≠a te dice que est√° mal.", coraje:"¬°Correcto! Coraje es decir 'no' a la presi√≥n de grupo y mantenerte firme en tus principios.", justicia:"Copiar es injusto.", templanza:"..." }
                },
                {
                    scenario: "Ves a alguien tirando basura en la calle.",
                    correctVirtue: "justicia",
                     feedback: { sabiduria:"Sabes que est√° mal.", coraje:"Podr√≠a requerir coraje decirle algo, pero la motivaci√≥n es la Justicia.", justicia:"¬°S√≠! Justicia es preocuparse por el bien com√∫n y el medio ambiente. Podr√≠as recogerla t√∫ o decirle algo (con Sabidur√≠a).", templanza:"..." }
                },
                 {
                    scenario: "Quieres ver un video m√°s en YouTube, pero ya es tu hora de dormir.",
                    correctVirtue: "templanza",
                     feedback: { sabiduria:"La Sabidur√≠a sabe que dormir es importante.", coraje:"...", justicia:"...", templanza:"¬°Exacto! Templanza es apagar el dispositivo y cumplir con tu horario." }
                },
                {
                    scenario: "Te das cuenta de que recibiste cambio de m√°s en la tienda.",
                    correctVirtue: "justicia",
                     feedback: { sabiduria:"La Sabidur√≠a sabe que devolverlo es lo correcto.", coraje:"...", justicia:"¬°Correcto! Justicia es ser honesto y devolver lo que no te pertenece.", templanza:"..." }
                },
                 {
                    scenario: "Te cuesta entender un tema de matem√°ticas y sientes ganas de rendirte.",
                    correctVirtue: "coraje",
                     feedback: { sabiduria:"La Sabidur√≠a es buscar ayuda o diferentes m√©todos.", coraje:"¬°S√≠! Coraje es la persistencia para seguir intentando aunque sea dif√≠cil.", justicia:"...", templanza:"..." }
                },
                {
                    scenario: "Tu abuelo Paco te pide ayuda con su celular, pero te parece complicado.",
                    correctVirtue: "justicia",
                     feedback: { sabiduria:"...", coraje:"...", justicia:"¬°Exacto! Justicia es ser paciente y ayudar a tu familia, aunque requiera esfuerzo.", templanza:"Necesitas Templanza (paciencia) pero la motivaci√≥n es la Justicia." }
                },
                 {
                    scenario: "Gastaste todo tu dinero en un juego y ahora no tienes para salir con amigos.",
                    correctVirtue: "sabiduria",
                     feedback: { sabiduria:"¬°S√≠! Sabidur√≠a es aprender de este error para planificar mejor tus gastos la pr√≥xima vez.", coraje:"...", justicia:"...", templanza:"Falt√≥ Templanza al gastar, pero la virtud a aplicar ahora es la Sabidur√≠a para aprender." }
                },
                 {
                    scenario: "Est√°s jugando Sonic y tu mam√° Jari te llama para poner la mesa.",
                    correctVirtue: "justicia",
                     feedback: { sabiduria:"...", coraje:"...", justicia:"¬°Correcto! Justicia es cumplir con tus responsabilidades en casa.", templanza:"Necesitas Templanza para pausar el juego sin quejarte." }
                },
                {
                   scenario: "Un amigo te cuenta un secreto y te pide que no se lo digas a nadie.",
                   correctVirtue: "justicia",
                   feedback: { sabiduria:"...", coraje:"...", justicia:"¬°S√≠! Justicia es ser leal y mantener tu palabra.", templanza:"..."}
                },
                {
                    scenario: "Tienes la opci√≥n de comer una ensalada o una pizza entera para cenar.",
                    correctVirtue: "templanza",
                    feedback: { sabiduria:"La Sabidur√≠a sabe qu√© es m√°s saludable.", coraje:"...", justicia:"...", templanza:"¬°Exacto! Templanza es elegir la moderaci√≥n y lo que es bueno para ti a largo plazo."}
                },
                {
                    scenario: "Ves que est√°n molestando a un chico nuevo en la escuela.",
                    correctVirtue: "coraje",
                    feedback: { sabiduria:"...", coraje:"¬°S√≠! Coraje es intervenir y defender al que est√° siendo maltratado, aunque te d√© miedo.", justicia:"La motivaci√≥n es la Justicia, pero la acci√≥n requiere Coraje.", templanza:"..."}
                },
                 {
                    scenario: "No entiendes la explicaci√≥n del profesor, pero te da verg√ºenza preguntar.",
                    correctVirtue: "coraje",
                    feedback: { sabiduria:"La Sabidur√≠a sabe que preguntar es bueno.", coraje:"¬°Correcto! Coraje es superar la verg√ºenza y levantar la mano para aclarar tu duda.", justicia:"...", templanza:"..."}
                },
                 {
                    scenario: "Tu equipo de f√∫tbol va perdiendo 3-0 al medio tiempo.",
                    correctVirtue: "coraje",
                    feedback: { sabiduria:"...", coraje:"¬°S√≠! Coraje es no rendirse, seguir luchando y animar a tus compa√±eros a pesar del resultado adverso.", justicia:"...", templanza:"La Templanza ayuda a no desesperarse."}
                },
                {
                   scenario: "Encuentras una cartera perdida en el parque.",
                   correctVirtue: "justicia",
                   feedback: { sabiduria:"...", coraje:"...", justicia:"¬°Exacto! Justicia es hacer lo correcto: buscar al due√±o o entregarla a las autoridades.", templanza:"..."}
                },
                 {
                    scenario: "Quieres pasar todo el s√°bado jugando videojuegos, pero sabes que tienes que ayudar a tu abuela Estela.",
                    correctVirtue: "justicia",
                    feedback: { sabiduria:"...", coraje:"...", justicia:"¬°S√≠! Justicia es equilibrar tu diversi√≥n con tus responsabilidades familiares.", templanza:"Necesitas Templanza para limitar tu tiempo de juego."}
                },
                {
                   scenario: "Un amigo te pide que le mientas a sus padres por √©l.",
                   correctVirtue: "justicia",
                   feedback: { sabiduria:"La Sabidur√≠a sabe que mentir est√° mal.", coraje:"Necesitas Coraje para decir no.", justicia:"¬°Correcto! Justicia es ser honesto y no participar en enga√±os.", templanza:"..."}
                },
                 {
                    scenario: "Te sientes frustrado porque no te sale un truco nuevo en la patineta.",
                    correctVirtue: "templanza",
                    feedback: { sabiduria:"...", coraje:"Necesitas Coraje para seguir intentando.", justicia:"...", templanza:"¬°S√≠! Templanza es manejar la frustraci√≥n, ser paciente contigo mismo y seguir practicando con calma."}
                },
                // ... (A√±adir hasta completar m√°s de 50)
            ];


            let currentChallengeIndex = 0; // Se declara aqu√≠, fuera de la funci√≥n de historias
            
            // B. Obtener elementos del DOM
            const scenarioTextEl = document.getElementById('scenario-text');
            const virtueButtonsEl = document.getElementById('virtue-buttons');
            const virtueFeedbackEl = document.getElementById('virtue-feedback');
            const nextChallengeButtonEl = document.getElementById('next-challenge-button');
            const allVirtueButtons = virtueButtonsEl.querySelectorAll('.virtue-button');
            
            // C. Funci√≥n para cargar un desaf√≠o
            function loadChallenge(index) {
                 if (!allChallenges || allChallenges.length === 0) {
                     console.error("La lista de desaf√≠os est√° vac√≠a o no definida.");
                     return; 
                 }
                 // Asegurarse de que el √≠ndice es v√°lido
                 const validIndex = index % allChallenges.length; 
                 const challenge = allChallenges[validIndex];
                 
                if (!challenge) {
                    console.error(`No se encontr√≥ desaf√≠o en el √≠ndice ${validIndex}`);
                    return;
                }

                if (scenarioTextEl) {
                     scenarioTextEl.textContent = challenge.scenario;
                } else {
                     console.error("Elemento 'scenario-text' no encontrado.");
                 }
                
                // Resetear botones y feedback
                 if (virtueFeedbackEl) virtueFeedbackEl.classList.add('hidden');
                 if (nextChallengeButtonEl) nextChallengeButtonEl.classList.add('hidden');
                 
                allVirtueButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                });
            }

            // D. Funci√≥n para manejar la elecci√≥n
            function handleVirtueChoice(e) {
                const chosenVirtue = e.currentTarget.getAttribute('data-virtue');
                const challenge = allChallenges[currentChallengeIndex];

                 if (!challenge || !challenge.feedback) {
                    console.error("Desaf√≠o actual o feedback no definido.");
                    return; // Salir si no hay desaf√≠o o feedback
                 }

                const feedback = challenge.feedback[chosenVirtue];
                const isCorrect = (chosenVirtue === challenge.correctVirtue);

                // Mostrar feedback
                 if (virtueFeedbackEl) {
                     virtueFeedbackEl.textContent = feedback || "Feedback no disponible."; // Mensaje por defecto
                     virtueFeedbackEl.classList.remove('hidden');
                     if (isCorrect) {
                         virtueFeedbackEl.className = "min-h-[100px] p-4 rounded-lg text-center text-lg font-medium bg-green-100 text-green-800 border border-green-300";
                         // ¬°NUEVO! Disparar confeti si la respuesta es correcta
                          if (typeof confetti === 'function') {
                             confetti({
                                 particleCount: 100,
                                 spread: 70,
                                 origin: { y: 0.6 }
                             });
                         }
                     } else {
                         virtueFeedbackEl.className = "min-h-[100px] p-4 rounded-lg text-center text-lg font-medium bg-yellow-100 text-yellow-800 border border-yellow-300";
                     }
                 } else {
                     console.error("Elemento 'virtue-feedback' no encontrado.");
                 }

                // Desactivar botones y mostrar "Siguiente"
                allVirtueButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                });
                 if (nextChallengeButtonEl) nextChallengeButtonEl.classList.remove('hidden');
            }

            // E. Asignar Event Listeners
            allVirtueButtons.forEach(btn => {
                btn.addEventListener('click', handleVirtueChoice);
            });

             if (nextChallengeButtonEl) {
                nextChallengeButtonEl.addEventListener('click', () => {
                    currentChallengeIndex++;
                    // Ya no reiniciamos si currentChallengeIndex >= allChallenges.length
                    // Usamos el m√≥dulo (%) en loadChallenge para ciclar
                    loadChallenge(currentChallengeIndex); 
                });
            }


            // --- L√ìGICA PARA EL VISOR DE HISTORIAS ---

            // A. Base de datos de todas las historias
            const allStories = [
                // Historias Cl√°sicas
                {
                    id: "epicteto",
                    title: "Epicteto, el Esclavo Sabio",
                    colorScheme: "cyan",
                    paragraphs: [
                        "Hab√≠a una vez un hombre llamado Epicteto que naci√≥ como esclavo. Ten√≠a un due√±o cruel que un d√≠a ¬°le rompi√≥ la pierna! üò¢",
                        "En lugar de enojarse toda su vida, Epicteto decidi√≥: 'No puedo controlar lo que me hicieron, pero <strong>S√ç puedo controlar c√≥mo pienso</strong> sobre ello.'",
                        "Estudi√≥, aprendi√≥, y cuando fue libre, se convirti√≥ en uno de los maestros m√°s sabios de la historia. Ense√±√≥ que nuestra verdadera libertad est√° en nuestra mente."
                    ],
                    lesson: "No importa qu√© cosas malas te pasen, siempre puedes elegir c√≥mo responder."
                },
                {
                    id: "marco_aurelio",
                    title: "El Emperador que Escrib√≠a su Diario",
                    colorScheme: "amber",
                    paragraphs: [
                        "Marco Aurelio era el hombre m√°s poderoso del mundo: ¬°era emperador de Roma! Ten√≠a ej√©rcitos, palacios y todo el oro que puedas imaginar. üëë",
                        "Pero cada noche, escrib√≠a en su diario record√°ndose a s√≠ mismo: 'No importa que sea emperador, sigo siendo solo una persona. Debo ser bueno, justo y sabio.'",
                        "Incluso el hombre m√°s poderoso necesitaba recordarse ser humilde y bueno cada d√≠a."
                    ],
                    lesson: "No importa qui√©n eres, siempre debes trabajar en ser una mejor persona."
                },
                {
                    id: "seneca",
                    title: "S√©neca y el Emperador Loco",
                    colorScheme: "red",
                    paragraphs: [
                        "S√©neca fue el maestro del joven emperador Ner√≥n. Pero Ner√≥n se volvi√≥ cruel y peligroso. Al final, Ner√≥n orden√≥ a S√©neca que se quitara la vida.",
                        "S√©neca no pod√≠a controlar la orden de Ner√≥n, pero s√≠ pod√≠a controlar c√≥mo morir: con dignidad y calma.",
                        "Enfrent√≥ su destino sin miedo, consolando a sus amigos y manteni√©ndose fiel a sus principios hasta el final."
                    ],
                    lesson: "No controlas las acciones de los dem√°s, por injustas que sean. Solo controlas tu propia integridad."
                },
                {
                    id: "zenon",
                    title: "Zen√≥n y el Naufragio",
                    colorScheme: "blue",
                    paragraphs: [
                        "Zen√≥n de Citio, el fundador del estoicismo, era un comerciante muy rico. Un d√≠a, una tormenta hundi√≥ su barco y perdi√≥ toda su fortuna.",
                        "Lleg√≥ a Atenas sin nada. En lugar de lamentarse, dijo: 'La fortuna me ordena ser un fil√≥sofo con menos equipaje'.",
                        "Empez√≥ a estudiar filosof√≠a y se dio cuenta de que perder sus cosas materiales le hab√≠a dado la libertad de encontrar la sabidur√≠a. Lo que parec√≠a un desastre, fue su mayor suerte."
                    ],
                    lesson: "A veces, perder lo que *tienes* te ayuda a encontrar lo que *eres*."
                },
                {
                    id: "cato",
                    title: "Cato, el Incorruptible",
                    colorScheme: "gray",
                    paragraphs: [
                        "Cato el Joven era un pol√≠tico romano famoso por ser terco... ¬°tercamente honesto! Vivi√≥ cuando el dictador Julio C√©sar estaba tomando el poder.",
                        "C√©sar intent√≥ sobornarlo, amenazarlo y hacerlo cambiar de bando. Pero Cato se neg√≥.",
                        "Prefiri√≥ morir defendiendo la Rep√∫blica que vivir bajo las √≥rdenes de un tirano. Para √©l, sus principios eran m√°s importantes que su vida."
                    ],
                    lesson: "El verdadero coraje es defender lo que es correcto, sin importar el precio."
                },
                {
                    id: "eleccion_hercules",
                    title: "La Elecci√≥n de H√©rcules",
                    colorScheme: "green",
                    paragraphs: [
                        "Cuando H√©rcules era joven, se encontr√≥ en una encrucijada. Dos diosas se le aparecieron: una era Kakia (vicio) y la otra Aret√© (virtud).",
                        "Kakia le ofreci√≥ una vida f√°cil, llena de fiestas, lujos y sin esfuerzo. Aret√© le ofreci√≥ una vida dif√≠cil, llena de desaf√≠os, trabajo duro y peligros, pero que al final tendr√≠a honor y ayudar√≠a a la humanidad.",
                        "H√©rcules eligi√≥ el camino dif√≠cil de Aret√©. Eligi√≥ la virtud sobre la comodidad."
                    ],
                    lesson: "El camino f√°cil rara vez te lleva a un lugar al que valga la pena ir. Elige el desaf√≠o."
                },
                {
                    id: "socrates",
                    title: "S√≥crates y la Cicuta",
                    colorScheme: "purple",
                    paragraphs: [
                        "S√≥crates (el maestro del maestro de Zen√≥n) fue acusado injustamente de 'corromper a la juventud' solo por hacer preguntas. Fue sentenciado a muerte.",
                        "Sus amigos planearon su escape de la prisi√≥n, pero S√≥crates se neg√≥. Dijo que hab√≠a vivido toda su vida obedeciendo las leyes de Atenas, y no iba a romperlas solo para salvarse.",
                        "Bebi√≥ el veneno (la cicuta) con calma, discutiendo sobre filosof√≠a con sus amigos hasta su √∫ltimo aliento."
                    ],
                    lesson: "Ser valiente no es solo pelear. Es vivir (y morir) de acuerdo con tus principios."
                },
                {
                    id: "bambu",
                    title: "La Paciencia del Bamb√∫ Japon√©s",
                    colorScheme: "green",
                    paragraphs: [
                        "Cuando siembras una semilla de bamb√∫ japon√©s, ¬°no ves nada durante siete a√±os! Solo riegas y esperas, mientras parece que nada ocurre.",
                        "Pero durante esos siete a√±os, el bamb√∫ est√° creando un sistema de ra√≠ces incre√≠blemente fuerte bajo tierra.",
                        "Y entonces, en solo seis semanas, ¬°el bamb√∫ crece m√°s de 30 metros! Su fuerza invisible se vuelve visible."
                    ],
                    lesson: "El esfuerzo que pones hoy (como estudiar o entrenar) construye las 'ra√≠ces' para tu √©xito de ma√±ana."
                },
                {
                    id: "diogenes",
                    title: "Di√≥genes y Alejandro Magno",
                    colorScheme: "yellow",
                    paragraphs: [
                        "Di√≥genes era un fil√≥sofo que cre√≠a en la simplicidad. Viv√≠a en un barril y no ten√≠a casi nada.",
                        "Un d√≠a, Alejandro Magno, el rey m√°s poderoso de la tierra, fue a visitarlo. 'Soy Alejandro, el gran rey. P√≠deme lo que quieras', le dijo.",
                        "Di√≥genes, que estaba tomando el sol, simplemente respondi√≥: 'S√≠, que te apartes. Me est√°s tapando el sol'. Alejandro qued√≥ tan impresionado que dijo: 'Si no fuera Alejandro, me gustar√≠a ser Di√≥genes'."
                    ],
                    lesson: "La verdadera riqueza no es tener mucho, sino necesitar poco."
                },
                {
                    id: "granjero_roca",
                    title: "El Granjero y la Roca",
                    colorScheme: "stone",
                    paragraphs: [
                        "Un granjero ten√≠a una enorme roca en medio de su campo. Odiaba esa roca. Cada a√±o, romp√≠a sus arados y le hac√≠a perder tiempo.",
                        "Un d√≠a, harto, tom√≥ una barra de hierro y decidi√≥ moverla. Le cost√≥ horas, sudor y esfuerzo, pero finalmente logr√≥ sacarla.",
                        "Debajo de la roca, encontr√≥ un cofre lleno de oro. El obst√°culo que tanto odiaba era, en realidad, su tesoro."
                    ],
                    lesson: "El obst√°culo es el camino. Lo que te parece m√°s dif√≠cil es, a menudo, lo que te har√° m√°s fuerte (o te dar√° un tesoro)."
                },
                {
                    id: "musonio",
                    title: "Musonio Rufo y el Exilio",
                    colorScheme: "blue",
                    paragraphs: [
                        "Musonio Rufo fue un maestro estoico exiliado (expulsado de su hogar) a una isla desierta y √°rida.",
                        "En lugar de quejarse de su mala suerte, vio el exilio como una oportunidad. Empez√≥ a cultivar la tierra √©l mismo y ense√±√≥ filosof√≠a a los pocos que lo visitaban.",
                        "Demostr√≥ que no importa *d√≥nde* est√©s, sino *qui√©n* eres. Puedes practicar la virtud en un palacio o en una isla desierta."
                    ],
                    lesson: "No puedes controlar d√≥nde te pone la vida, pero s√≠ puedes controlar qu√© haces en ese lugar."
                },
                {
                    id: "aguila",
                    title: "El √Åguila que Renace",
                    colorScheme: "orange",
                    paragraphs: [
                        "Se cuenta que cuando un √°guila envejece, su pico se curva, sus garras se vuelven d√©biles y sus plumas, pesadas.",
                        "Para sobrevivir, vuela a lo alto de una monta√±a y comienza un proceso doloroso: golpea su pico contra una roca hasta romperlo. Cuando le crece uno nuevo, arranca sus viejas garras. Con las nuevas, arranca sus plumas viejas.",
                        "Despu√©s de este duro proceso, el √°guila renace y puede vivir muchos a√±os m√°s. Acepta el dolor para poder transformarse."
                    ],
                    lesson: "Para ser m√°s fuerte, a veces hay que soltar las 'plumas viejas': malos h√°bitos o pensamientos que ya no te sirven."
                },
                {
                    id: "escultor",
                    title: "El Escultor Estoico",
                    colorScheme: "gray",
                    paragraphs: [
                        "Un estudiante le pregunt√≥ a un maestro escultor: '¬øC√≥mo puedes crear una estatua tan bella de un le√≥n a partir de un bloque de m√°rmol tan feo?'",
                        "El escultor respondi√≥: 'Yo no creo al le√≥n. El le√≥n ya est√° dentro de la piedra. Mi √∫nico trabajo es quitar las partes de la piedra que *no* son el le√≥n'.",
                        "Los estoicos ve√≠an nuestra mente igual: tu 'yo' valiente y sabio ya est√° dentro. Tu trabajo es quitar el miedo, la pereza y el enojo que *no* son t√∫."
                    ],
                    lesson: "Tu 'yo' ideal ya est√° dentro de ti. Tu trabajo es quitar lo que sobra."
                },
                {
                    id: "horacio",
                    title: "Horacio en el Puente",
                    colorScheme: "red",
                    paragraphs: [
                        "Un ej√©rcito enemigo avanzaba sobre Roma. La √∫nica forma de salvar la ciudad era destruir el √∫nico puente que cruzaba el r√≠o.",
                        "Mientras los soldados romanos destru√≠an el puente, un h√©roe llamado Horacio, junto con dos amigos, se pararon en el otro extremo y detuvieron a todo el ej√©rcito enemigo.",
                        "Sab√≠a que iba a morir, pero eligi√≥ sacrificarse para darle a su ciudad el tiempo que necesitaba para salvarse. Puso el bien de todos por encima de su propia vida."
                    ],
                    lesson: "El verdadero coraje (y la justicia) es hacer lo correcto por los dem√°s, incluso si tienes miedo."
                },
                {
                    id: "crisipo",
                    title: "Crisipo, el Corredor",
                    colorScheme: "cyan",
                    paragraphs: [
                        "Crisipo fue un fil√≥sofo estoico que era un corredor de larga distancia. √âl usaba las carreras como met√°fora.",
                        "Dec√≠a: 'En una carrera, no controlas si el otro corredor es m√°s r√°pido. No controlas si tropiezas con una piedra'.",
                        "'Solo controlas estirar tus piernas, mantener tu ritmo y dar tu m√°ximo esfuerzo hasta la meta'. La vida es igual: no compitas contra otros, compite por ser tu mejor versi√≥n."
                    ],
                    lesson: "No te preocupes por ganar a los dem√°s. Preoc√∫pate por dar tu 100% de esfuerzo."
                },

                // --- Historias de El√≠as ---
                {
                    id: "elias_futbol",
                    title: "El√≠as y el Penal Fallado",
                    colorScheme: "green",
                    paragraphs: [
                        "Final del partido. Empatados. El√≠as se prepara para tirar el penal decisivo. ¬°Lo falla! El otro equipo gana.",
                        "Camino a casa, su hermana Elisa le dice: '¬°Qu√© mal tiraste!'. El√≠as siente c√≥mo le hierve la sangre. Est√° furioso.",
                        "Pero entonces, recuerda: 'No controlo el resultado. No controlo lo que dice Elisa'. Respira hondo y, en lugar de gritar, dice: 'S√≠, fue un mal tiro. Practicar√© m√°s para la pr√≥xima'."
                    ],
                    lesson: "No controlas las burlas ni el resultado, pero s√≠ controlas tu esfuerzo y tu calma."
                },
                {
                    id: "elias_minecraft",
                    title: "El√≠as y el Creeper Traicionero",
                    colorScheme: "emerald",
                    paragraphs: [
                        "El√≠as pas√≥ tres horas construyendo una base incre√≠ble en Minecraft. Ten√≠a todo: cultivos, cofres, ¬°hasta una torre de vigilancia!",
                        "De repente... 'Tsssss... ¬°BOOM!'. Un creeper apareci√≥ de la nada y destruy√≥ la mitad de su creaci√≥n. El√≠as estaba listo para apagar el juego y no volver a jugar.",
                        "Su abuelo Paco lo vio y le dijo: 'El creeper es como un mal d√≠a. No lo controlas. Pero s√≠ controlas si te rindes, o si lo construyes de nuevo, esta vez a√∫n mejor'."
                    ],
                    lesson: "La verdadera construcci√≥n no es la de bloques, sino la de tu paciencia al volver a empezar."
                },
                {
                    id: "elias_natacion",
                    title: "El√≠as y el Agua Fr√≠a",
                    colorScheme: "sky",
                    paragraphs: [
                        "Era martes, d√≠a de nataci√≥n. Hac√≠a fr√≠o y El√≠as estaba cansado. 'Mam√°, no quiero ir', le dijo a Jari.",
                        "Su mam√° Jari se sent√≥ a su lado y le dijo: 'Yo no puedo nadar por ti, El√≠as. Solo puedo llevarte. La decisi√≥n de esforzarte en la alberca, aunque el agua est√© fr√≠a, es 100% tuya'.",
                        "El√≠as fue. Se meti√≥ al agua fr√≠a y, aunque le cost√≥, dio su mejor esfuerzo. Sali√≥ de la alberca sinti√©ndose orgulloso."
                    ],
                    lesson: "No controlas c√≥mo te sientes (cansado o con flojera), pero s√≠ controlas lo que *haces*."
                },
                {
                    id: "elias_switch",
                    title: "El√≠as, Elisa y el Jefe de Sonic",
                    colorScheme: "blue",
                    paragraphs: [
                        "El√≠as estaba en la batalla final contra el jefe en su Nintendo Switch. ¬°Estaba a punto de ganar!",
                        "Justo en ese momento, su hermana Elisa entr√≥. '¬°Es mi turno! ¬°Me prometiste!'. El√≠as quer√≠a gritarle que se fuera.",
                        "Record√≥ la 'Justicia'. Respir√≥, paus√≥ el juego (¬°justo a tiempo!) y le dijo: 'Tienes raz√≥n. Termino este jefe y es tu turno, ¬øde acuerdo? Seamos justos'. Elisa sonri√≥ y asinti√≥."
                    ],
                    lesson: "Ser justo (Justicia) significa respetar a los dem√°s, incluso cuando interrumpe tu diversi√≥n."
                },
                {
                    id: "elias_karate",
                    title: "El√≠as y la Disciplina de la Abuela Estela",
                    colorScheme: "purple",
                    paragraphs: [
                        "Era jueves por la tarde. El√≠as ten√≠a un mont√≥n de tarea de matem√°ticas, pero su mundo de Minecraft lo llamaba.",
                        "Su abuela Estela lo vio mirando el control del Switch. '¬øQu√© es m√°s importante ahora mismo?', le pregunt√≥ con calma.",
                        "'¬øRecuerdas tus clases de karate? La disciplina (Templanza) no era solo para dar golpes. Es el poder para hacer lo que *debes* hacer, antes de hacer lo que *quieres* hacer'. El√≠as suspir√≥, guard√≥ el control y sac√≥ su cuaderno."
                    ],
                    lesson: "La Templanza (autocontrol) es tu superpoder para vencer al enemigo m√°s dif√≠cil: la flojera."
                }
            ];

            // B. Obtener elementos del DOM (Visor de Historias)
            const storySelector = document.getElementById('story-selector');
            const storyContentWrapper = document.getElementById('story-content-wrapper');

            // C. Funci√≥n para poblar el selector de historias
            function populateStorySelector() {
                if (!storySelector) return; // Salir si no existe
                storySelector.innerHTML = ''; // Limpiar opciones anteriores
                allStories.forEach(story => {
                    const option = document.createElement('option');
                    option.value = story.id;
                    option.textContent = story.title;
                    storySelector.appendChild(option);
                });
            }

            // D. Funci√≥n para mostrar una historia espec√≠fica
            function displayStory(storyId) {
                if (!storyContentWrapper) return; // Salir si no existe
                const story = allStories.find(s => s.id === storyId);
                if (!story) return;

                // 1. Construir HTML del contenido (La imagen ya es est√°tica)
                let contentHTML = `
                    <h3 class="text-2xl font-bold text-${story.colorScheme}-700 mb-4">${story.title}</h3>
                `;
                
                story.paragraphs.forEach(p => {
                    contentHTML += `<p class="mb-4 text-lg leading-relaxed">${p}</p>`;
                });

                contentHTML += `
                    <div class="mt-auto bg-${story.colorScheme}-100 border-l-4 border-${story.colorScheme}-500 p-4 rounded-r-lg">
                        <strong class="text-${story.colorScheme}-800">Lecci√≥n:</strong> "${story.lesson}"
                    </div>
                `;

                // 3. Inyectar HTML
                storyContentWrapper.innerHTML = contentHTML;
            }

            // E. Event Listener para el selector
            if (storySelector) {
                storySelector.addEventListener('change', (e) => {
                    displayStory(e.target.value);
                });
            }

            // F. Carga inicial
            function initializeStoryViewer() {
                populateStorySelector();
                
                // Elegir una historia al azar
                const randomIndex = Math.floor(Math.random() * allStories.length);
                const randomStory = allStories[randomIndex];

                // Sincronizar el dropdown y mostrar la historia
                if (storySelector) {
                    storySelector.value = randomStory.id;
                }
                displayStory(randomStory.id);
            }

            // --- L√ìGICA PARA EL FOOTER ALEATORIO ---
            function setRandomFooterQuote() {
                const intros = [
                    "¬°Sigue as√≠, El√≠as!",
                    "¬°Un pensamiento de h√©roe para ti, El√≠as!",
                    "¬°Fuerza, El√≠as!",
                    "¬°T√∫ puedes, El√≠as!",
                    "¬°Palabras sabias para ti, El√≠as!"
                ];
                
                const quotes = [
                    "El obst√°culo es el camino. ¬°Cada desaf√≠o te hace m√°s fuerte!",
                    "Ser estoico significa ser como un roble: firme ante la tormenta, pero flexible para no romperse.",
                    "La felicidad no est√° en lo que pasa, sino en c√≥mo eliges ver lo que pasa.",
                    "El verdadero superpoder es el autocontrol. ¬°Domina tus reacciones!",
                    "Conc√©ntrate en tu esfuerzo, no en el resultado. ¬°Ah√≠ est√° tu verdadero control!",
                    "Hoy es una nueva oportunidad para practicar tu coraje y tu paciencia.",
                    "No te preocupes por lo que no puedes cambiar. Invierte tu energ√≠a en lo que s√≠ puedes hacer.",
                    "La calma es tu escudo. √ösala cuando sientas enojo o miedo.",
                    "Cada vez que eliges ser amable o justo, ganas una batalla interior.",
                    "Tu mente es tu fortaleza. ¬°T√∫ decides qui√©n entra y qui√©n no!"
                ];

                const randomIntro = intros[Math.floor(Math.random() * intros.length)];
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                
                const footerQuoteElement = document.getElementById('footer-quote');
                if (footerQuoteElement) {
                    footerQuoteElement.innerHTML = `<strong class="block mb-2">${randomIntro}</strong> "${randomQuote}"`;
                }
            }

            // --- ARRANQUE INICIAL ---
            // Juego
            populateWorriesList(); // Crea los primeros 7
            setupDraggables();     // Les asigna los listeners
            
            // Desaf√≠o de Virtudes
            shuffleArray(allChallenges); // Mezcla los desaf√≠os
            loadChallenge(0);            // Carga el primer desaf√≠o

            // Visor de Historias
            initializeStoryViewer(); // Carga las historias y muestra una al azar
            
            // Footer
            setRandomFooterQuote(); // Establece la frase aleatoria del footer
        });
    </script>

</body>
</html>

